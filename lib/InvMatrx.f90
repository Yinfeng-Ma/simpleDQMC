!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
! PROGRAM: Several subroutines used to calculate the matrix inverse for real and complex square matrices separately.
!              The subroutines calculate both the inverse matrix and determinant for the input square matrix.
!
!          Need the LinPack mathematical library.
!
! COMMENT: Common file.  
! AUTHOR:  Yuan-Yao He
! DATE:    2014-12-21
! PURPOSE: Different subroutines are introduced as following:
!
!    InvMatrx_R --> Subroutine to calculate the inverse of real square matrix and its determinant;    --> Input A is square and det is a number
!    InvMatrx_C --> Subroutine to calculate the inverse of complex square matrix and its determinant; --> Input A is square and det(2)
!             
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

   
   
   
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
!____________________________________ Begin subroutine ____________________________________________________________________________________
!__________________________________________________________________________________________________________________________________________  
	subroutine InvMatrx_R(LDA, A, AInv, Det)
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
! PROGRAM: InvMatrx_R(LDA, A, AInv, Det)
! TYPE:     subroutine
! PURPOSE:  This Subroutine is used to calculate the matrix inverse for real square matrix.
! KEYWORDS: Calculate Matrix inverse, real version.
! AUTHOR:   Yuan-Yao He
! TIME:     2014-12-01
! DESCRIPTION:
!
!     Calculate Matrix inverse, real version. 
!
!     Input: LDA --> Dimension of input A matrix;
!            A   --> Input real square matrix;
!
!     Outpt: A   --> Result output real inv matrix of A matrix.
!            Det --> The determinant of A matrix.
!
! MODULES USED: RealPrecsn
! SUBROUTINES CALLED: (1) LinPack Library: DGEFA, DGEDI
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  			
!______________________________________________________________________________________________________________	  
!_________________________________________ Modules used in this subroutine ____________________________________
!______________________________________________________________________________________________________________ 
		implicit none
!______________________________________________________________________________________________________________	  
!_________________________________________ All Input and Output Quantities ____________________________________
!______________________________________________________________________________________________________________
		integer LDA                ! Dimension of A square matrix
		real(8) Det               ! Determinant for A matrix
		real(8) A(LDA, LDA)       ! The input A matrix
		real(8) AInv(LDA, LDA)    ! The output Inv(A) matrix
!______________________________________________________________________________________________________________	  
!______________________________ Temperory Quantities used in the calculations _________________________________
!______________________________________________________________________________________________________________
		integer I1   ! Loop integer 
		integer I2   ! Loop integer
				
		integer Info
		integer Job
				
		real(8) Det0(2)
				
		integer, allocatable :: IPVT(:)
		real(8), allocatable :: Work(:)
!______________________________________________________________________________________________________________	  
!__________________________________ Allocate Array and Initializations ________________________________________
!______________________________________________________________________________________________________________
		allocate(IPVT(LDA))
		allocate(Work(LDA))
		IPVT = 0.0_8
		Work = 0.0_8
!______________________________________________________________________________________________________________	  
!_______________________________ Main calculations of Creating matrix _________________________________________
!______________________________________________________________________________________________________________
		do I1 = 1, LDA
			do I2 = 1, LDA
				AInv(I1, I2) = A(I1, I2)
			enddo
		enddo
				
		call DGEFA(AInv, LDA, LDA, IPVT, Info)
		Job = 11
		call DGEDI(AInv, LDA, LDA, IPVT, Det0, Work, Job)
				
		Det = Det0(1) * 10.0_8**Det0(2)
!______________________________________________________________________________________________________________	  
!___________________________________________ Deallocate the arrays ____________________________________________
!______________________________________________________________________________________________________________
		deallocate(IPVT)
		deallocate(Work)
		
   end subroutine
!__________________________________________________________________________________________________________________________________________  
!____________________________________ End subroutine ______________________________________________________________________________________
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$



	subroutine InvMatrx_D(LDA, A)
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%    
! PROGRAM: InvMatrx_D(LDA, A)
! TYPE:     subroutine
! PURPOSE:  This Subroutine is used to calculate the matrix inverse for real square matrix.
! KEYWORDS: Calculate Matrix inverse, real version.
! AUTHOR:   Yuan-Yao He
! TIME:     2014-12-01
! DESCRIPTION:
!
!     Calculate Matrix inverse, real version. 
!
!     Input: LDA --> Dimension of input A matrix;
!            A   --> Input real square matrix;
!
!     Outpt: A   --> Result output real inv matrix of A matrix.
!
! MODULES USED: RealPrecsn
! SUBROUTINES CALLED: (1) LinPack Library: DGEFA, DGEDI
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  			
!______________________________________________________________________________________________________________	  
!_________________________________________ Modules used in this subroutine ____________________________________
!______________________________________________________________________________________________________________ 
		implicit none
!______________________________________________________________________________________________________________	  
!_________________________________________ All Input and Output Quantities ____________________________________
!______________________________________________________________________________________________________________
		integer LDA                ! Dimension of A square matrix
		real(8) A(LDA, LDA)       ! The input A matrix, and output A^-1
!______________________________________________________________________________________________________________	  
!______________________________ Temperory Quantities used in the calculations _________________________________
!______________________________________________________________________________________________________________
		integer I1   ! Loop integer 
		integer I2   ! Loop integer
				
		integer Info
		integer Job
				
		real(8) Det0(2)
				
		integer, allocatable :: IPVT(:)
		real(8), allocatable :: Work(:)
        real(8), allocatable :: AInv(:,:)
!______________________________________________________________________________________________________________	  
!__________________________________ Allocate Array and Initializations ________________________________________
!______________________________________________________________________________________________________________
		allocate(IPVT(LDA))
		allocate(Work(LDA))
        allocate(AInv(LDA,LDA))
		IPVT = 0.0_8
		Work = 0.0_8
!______________________________________________________________________________________________________________	  
!_______________________________ Main calculations of Creating matrix _________________________________________
!______________________________________________________________________________________________________________
		do I1 = 1, LDA
			do I2 = 1, LDA
				AInv(I1, I2) = A(I1, I2)
			enddo
		enddo
				
		call DGEFA(AInv, LDA, LDA, IPVT, Info)
		Job = 11
		call DGEDI(AInv, LDA, LDA, IPVT, Det0, Work, Job)
        A = AInv
!______________________________________________________________________________________________________________	  
!___________________________________________ Deallocate the arrays ____________________________________________
!______________________________________________________________________________________________________________
        deallocate(AInv)
		deallocate(IPVT)
		deallocate(Work)
		
   end subroutine
!__________________________________________________________________________________________________________________________________________  
!____________________________________ End subroutine ______________________________________________________________________________________
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

   
   
   
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
!____________________________________ Begin subroutine ____________________________________________________________________________________
!__________________________________________________________________________________________________________________________________________ 
	subroutine InvMatrx_C(LDA, A, AInv, Det)
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
! PROGRAM:  InvMatrx_C(LDA, A, AInv, Det)
! TYPE:     subroutine
! PURPOSE:  This Subroutine is used to calculate the matrix inverse for complex square matrix.
! KEYWORDS: Calculate Matrix inverse, real version.
! AUTHOR:   Yuan-Yao He
! TIME:     2014-12-01
! DESCRIPTION:
!
!     Calculate Matrix inverse, complex version. 
!
!     Input: LDA  --> Dimension of A matrix;
!            A    --> Input complex square matrix;
!
!     Outpt: AInv --> Result output complex diagonal matrix.
!            Det  --> The determinant of A matrix.
!
! MODULES USED: RealPrecsn
! SUBROUTINES CALLED:  (none)
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 			
!______________________________________________________________________________________________________________	  
!_________________________________________ Modules used in this subroutine ____________________________________
!______________________________________________________________________________________________________________ 
		implicit none
!______________________________________________________________________________________________________________	  
!_________________________________________ All Input and Output Quantities ____________________________________
!______________________________________________________________________________________________________________
		integer LDA                   ! Dimension of input A matrix 
		complex(8) Det(2)            ! The determinant of A matrix
		complex(8) A(LDA, LDA)       ! Input A matrix
		complex(8) AInv(LDA, LDA)    ! Output Inv(A) matrix
!______________________________________________________________________________________________________________	  
!______________________________ Temperory Quantities used in the calculations _________________________________
!______________________________________________________________________________________________________________
		integer I1   ! Loop integer 
		integer I2   ! Loop integer
				
		integer Info
		integer Job
				
		integer, allocatable :: IPVT(:)
		complex(8), allocatable :: Work(:)
!______________________________________________________________________________________________________________	  
!__________________________________ Allocate Array and Initializations ________________________________________
!______________________________________________________________________________________________________________
		allocate(IPVT(LDA))
		allocate(Work(LDA))
		IPVT = 0.0_8
		Work = 0.0_8
!______________________________________________________________________________________________________________	  
!_______________________________ Main calculations of Creating matrix _________________________________________
!______________________________________________________________________________________________________________
		do I1 = 1, LDA
			do I2 = 1, LDA
				AInv(I1, I2) = A(I1, I2)
			enddo
		enddo
				
		call ZGEFA(AInv, LDA, LDA, IPVT, Info)
		Job = 11
		call ZGEDI(AInv, LDA, LDA, IPVT, Det, Work, Job)
!______________________________________________________________________________________________________________	  
!___________________________________________ Deallocate the arrays ____________________________________________
!______________________________________________________________________________________________________________
		deallocate(IPVT)
		deallocate(Work)
		
	end subroutine
!__________________________________________________________________________________________________________________________________________  
!____________________________________ End subroutine ______________________________________________________________________________________
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$




!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
!____________________________________ Begin subroutine ____________________________________________________________________________________
!__________________________________________________________________________________________________________________________________________ 
	subroutine InvMatrx_Z(LDA, A )
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%   
! PROGRAM:  InvMatrx_C(LDA, A )
! TYPE:     subroutine
! PURPOSE:  This Subroutine is used to calculate the matrix inverse for complex square matrix.
! KEYWORDS: Calculate Matrix inverse, real version.
! AUTHOR:   Yuan-Yao He
! TIME:     2014-12-01
! DESCRIPTION:
!
!     Calculate Matrix inverse, complex version. 
!
!     Input: LDA  --> Dimension of A matrix;
!            A    --> Input complex square matrix;
!
!     Outpt: A    --> Result output complex diagonal matrix.
!
! MODULES USED: RealPrecsn
! SUBROUTINES CALLED:  (none)
! END PROGRAM
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 			
!______________________________________________________________________________________________________________	  
!_________________________________________ Modules used in this subroutine ____________________________________
!______________________________________________________________________________________________________________ 
		implicit none
!______________________________________________________________________________________________________________	  
!_________________________________________ All Input and Output Quantities ____________________________________
!______________________________________________________________________________________________________________
		integer LDA                   ! Dimension of input A matrix 
		complex(8) A(LDA, LDA)       ! Input A matrix
!______________________________________________________________________________________________________________	  
!______________________________ Temperory Quantities used in the calculations _________________________________
!______________________________________________________________________________________________________________
		integer I1   ! Loop integer 
		integer I2   ! Loop integer
				
		integer Info
		integer Job
		complex(8) Det(2)            ! The determinant of A matrix
		complex(8), allocatable :: AInv(:,:)  ! Inv(A) matrix
				
		integer, allocatable :: IPVT(:)
		complex(8), allocatable :: Work(:)
!______________________________________________________________________________________________________________	  
!__________________________________ Allocate Array and Initializations ________________________________________
!______________________________________________________________________________________________________________
        allocate( AInv(LDA,LDA) )
		allocate(IPVT(LDA))
		allocate(Work(LDA))
		IPVT = 0.0_8
		Work = 0.0_8
!______________________________________________________________________________________________________________	  
!_______________________________ Main calculations of Creating matrix _________________________________________
!______________________________________________________________________________________________________________
		do I1 = 1, LDA
			do I2 = 1, LDA
				AInv(I1, I2) = A(I1, I2)
			enddo
		enddo
				
		call ZGEFA(AInv, LDA, LDA, IPVT, Info)
		Job = 11
		call ZGEDI(AInv, LDA, LDA, IPVT, Det, Work, Job)
        A=AInv
!______________________________________________________________________________________________________________	  
!___________________________________________ Deallocate the arrays ____________________________________________
!______________________________________________________________________________________________________________
		deallocate(Work)
		deallocate(IPVT)
        deallocate(AInv)
		
	end subroutine
!__________________________________________________________________________________________________________________________________________  
!____________________________________ End subroutine ______________________________________________________________________________________
!$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
